@model ProjectSupport.Core.Models.JobTask

@{
    ViewData["Title"] = "Details";
    Layout = "_Navigation_Layout_for_Details.cshtml";
    ViewData["Model"] = Model;
}



@Html.Partial("_MultiColumn_for_General_2Columns-Start", "DetailsFields")




<div class='paragraph-with-Definition-p80-JumpToLeft justify-wrap-break'>
    <strong class='ParagraphTitle font-weight-bold mr-3 d-inline-block text-right'>
        Project Name
    </strong>
    <a class="card-text text-truncate font-italic max-height-65" href="~/projects/@Model.Project_Ref">
        @Html.DisplayFor(model => model.Project.ProjectName)
    </a>
</div>

<div class='paragraph-with-Definition-p80-JumpToLeft justify-wrap-break'>
    <strong class='ParagraphTitle font-weight-bold mr-3 d-inline-block text-right'>
        @Html.DisplayNameFor(model => model.PentestType)
    </strong>
    @Html.DisplayFor(model => model.PentestType)
</div>
<div class='paragraph-with-Definition-p80-JumpToLeft justify-wrap-break'>
    <strong class='ParagraphTitle font-weight-bold mr-3 d-inline-block text-right'>
        @Html.DisplayNameFor(model => model.CreationDateTime)
    </strong>
    @Html.DisplayFor(model => model.CreationDateTime_in_PersianDate)
</div>


<div class='paragraph-with-Definition-p80-JumpToLeft justify-wrap-break'>
    <strong class='ParagraphTitle font-weight-bold mr-3 d-inline-block text-right'>
        @Html.DisplayNameFor(model => model.Status)
    </strong>
    @{
        bool complated = false;
        var lastResponse = Model.TaskResponse_to_getVulnerabilitiesCount;
        if (lastResponse != null && (lastResponse.IsDone ||
            (Model.TaskResponses.LastOrDefault()?.High_Vulnerabilities_Count == 0 &&
            Model.TaskResponses.LastOrDefault()?.Medium_Vulnerabilities_Count == 0 &&
            Model.TaskResponses.LastOrDefault()?.Low_Vulnerabilities_Count == 0)
            ))
        {
            complated = true;
        }
    }
    @if (complated)
    {
        <i class="fas fa-check fa-md pr-2" aria-hidden="true"></i>
    }
    else if (lastResponse == null)
    {
        @("In Progress")
    }
    else
    {
        <span class="red-text">H:</span>@(lastResponse.High_Vulnerabilities_Count)@:,&nbsp;
        <span class="orange-ic">M:</span>@(lastResponse.Medium_Vulnerabilities_Count)@:,&nbsp;
        <span class="blue-text">L:</span>@(lastResponse.Low_Vulnerabilities_Count)
    }
</div>




<div class='paragraph-with-Definition-p80-JumpToLeft justify-wrap-break'>
    <strong class='ParagraphTitle font-weight-bold mr-3 d-inline-block text-right'>
        @Html.DisplayNameFor(model => model.ExternalRequesterDetails)
    </strong>
    @Html.DisplayFor(model => model.ExternalRequesterDetails)
</div>

@{
    bool isExternal = false;
    foreach (var pent in Model.Pentesters)
    {
        if (pent.Pentester.ThirdParty)
        {
            isExternal = true;
            break;
        }
    }

    if (isExternal || !string.IsNullOrEmpty(Model.PeriodNameForThirdParties))
    {
        <div class='paragraph-with-Definition-p80-JumpToLeft justify-wrap-break'>
            <strong class='ParagraphTitle font-weight-bold mr-3 d-inline-block text-right'>
                @Html.DisplayNameFor(model => model.PeriodNameForThirdParties)
            </strong>
            @Html.DisplayFor(model => model.PeriodNameForThirdParties)
        </div>
    }
}



@Html.Partial("_MultiColumn_for_General_2Columns-End", "DetailsFields")






<div class="row text-left paragraph-with-Definition-p80-JumpToLeft pl-0 mx-0 my-2"
     @*class="row text-left paragraph-with-Definition-p80-JumpToLeft p-3 mx-0"*@
     style="margin-left: -60px !important;">
    <h5 class="d-inline-block text-right my-1">Pentesters:&nbsp&nbsp</h5>
    @*<strong class="ParagraphTitle font-weight-bold mr-3 d-inline-block text-right">Pentesters:&nbsp&nbsp</strong>
    *@
    @foreach (var pentester in Model.Pentesters)
    {
        <div class="chip mb-1">
            @*<img src="https://mdbootstrap.com/img/Photos/Avatars/avatar-6.jpg" alt="Contact Person">*@
            <i class="fas fa-user mr-1"></i>
            @Html.DisplayFor(model => pentester.Pentester.ApplicationUser.FullName)
        </div>
    }

</div>



@if (Model.Description?.Length > 0)
{
    <div class="card-body text-left pt-1">
        <h5 class=" mb-0 mt-3 mr-auto d-inline-block">Description</h5>
    </div>
    <div class="flex0 mt-n2 border ">
        <p class="p-3 mt-0 card-text text-justify  w-100 @Model.Description.GetTextLangDirection() ">
            @Html.Raw(Model.Description_Printable)
        </p>
    </div>
}


@{
    var urls = new AttachmentUploadObject(ViewBag.sp)
    {
        Attachments = Model.Attachments,
        IsReadOnly = true
    };
}
<partial name="~/Views/Shared/Partials/Attachment/AttachmentLoader.cshtml" for="@urls" />


<!-- responses -->
<partial name="~/Views/Responses/List.cshtml" for="@Model" />







