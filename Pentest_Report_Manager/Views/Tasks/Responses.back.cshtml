@model ProjectSupport.Core.Models.JobTask
@*@model IEnumerable<ProjectSupport.Core.Models.TaskResponse>*@


@{
    ViewData["Title"] = "Details";
    Layout = "_Navigation_Layout_for_Details.cshtml";
    ViewData["Model"] = Model;
}


<style>

    .replycolor {
        background: rgb(255,255,255);
        background: linear-gradient(90deg, rgba(255,255,255,0) 44%, rgba(208,191,144,1) 92%);
    }
</style>







@foreach (var item in Model.TaskResponses)
{
    if (item.IsDeleted)
    { continue; }

    <!-- Card -->
<div class="card promoting-card mb-4">

    
    <!-- Card Header -->
    <div class="row  mx-1">
        <div class="col-8 p-3 text-left">

            <!-- Title -->
            <a href="#" class="font-weight-bold text-left ml-3 mb-0 mt-1" style="font-size:18px;">
                @Html.DisplayFor(m => item.Title)
            </a>

        </div>

        <!-- User and Date -->
        <div class="col-4 d-flex pt-2">

            <!-- Avatar -->
            @*<img src="https://mdbootstrap.com/img/Photos/Avatars/avatar-8.jpg" class="rounded-circle mr-3" height="50px" width="50px" alt="avatar" />*@
            <i class="fas fa-user-circle mt-1 mr-2 ml-auto" style="font-size: 35px;" alt="avatar"></i>

            <!-- Content -->
            <div class="mr-3">
                <!-- User -->
                <div class="card-title  mb-0" style="font-size:15px;">@item.Submitter_ApplicationUser.FullName</div>

                <!-- Subtitle -->
                <p class="card-text" style="font-size:12px;">@(((DateTime) item.CreationDateTime).ToString("yyyy/MM/dd"))</p>

            </div>


        </div>
    </div>
    <hr class="mt-0" />





    <!-- Card content -->
    <div class="card-body2 row " style="padding:30px;">


        <!-- Sent Leters -->

        <div class="col-12 col-md-6">
            @{
                var urls = new AttachmentUploadObject()
                {
                    Attachment = item.ReportFileAndPDF.DocFile,
                    IsMultiple = false,
                    ParagraphTitle = "Pentest Report .Docx File",
                    AttachmentsIDs_FieldName = "docFileName",
                    IsReadOnly = true
                };
                urls.InitiateFields(ViewBag.sp);
            }
            <partial name="~/Views/Shared/Partials/Attachment/AttachmentLoader.cshtml" for="@urls" />
        </div>



        <div class="col-12 col-md-6">
            @{
                var urls2 = new AttachmentUploadObject()
                {
                    Attachment = item.ReportFileAndPDF.PdfFile,
                    IsMultiple = false,
                    ParagraphTitle = "Pentest Report .PDF File",
                    AttachmentsIDs_FieldName = "pdfFileName",
                    Do_not_insert_formId_and_Mac_inputs = true,
                    IsReadOnly = true
                };
                urls2.InitiateFields(ViewBag.sp);
            }
            <partial name="~/Views/Shared/Partials/Attachment/AttachmentLoader.cshtml" for="@urls2" />
        </div>





        <div class="col-12 text-right " style="background-color:navajowhite;">
            <ul class="nav md-pills pills-secondary">
                <li class="nav-item">
                    <span class="counter counter-lg">@item.High_Vulnerabilities_Count</span>
                    <a class="nav-link active" data-toggle="tab" href="#panelH_@item.ID" role="tab">High Vulnerabilities</a>

                </li>
                <li class="nav-item">
                    <span class="counter counter-lg " style="background-color:darksalmon;">@item.Medium_Vulnerabilities_Count</span>
                    <a class="nav-link" data-toggle="tab" href="#panelM_@item.ID" role="tab">Medium Vulnerabilities</a>
                </li>
                <li class="nav-item">
                    <span class="counter counter-lg " style="background-color:cornflowerblue;">@item.Low_Vulnerabilities_Count</span>
                    <a class="nav-link" data-toggle="tab" href="#panelL_@item.ID" role="tab">Low Vulnerabilities</a>
                </li>
            </ul>

            <!-- Tab panels -->
            <div class="tab-content pt-0">

                <!--Panel 1-->
                <div class="tab-pane fade in show active" id="panelH_@item.ID" role="tabpanel">
                    <br>

                    <ul class="list-group list-group-flush">
                        @foreach (var vul_string in item.Vulnerablities_Titles.Where(v => v.Label == "H").ToList())
                        {
                            <li class="list-group-item" style="background-color:navajowhite !important;">@vul_string.Text</li>
                        }
                    </ul>

                </div>
                <!--/.Panel 1-->
                <!--Panel 2-->
                <div class="tab-pane fade" id="panelM_@item.ID" role="tabpanel">
                    <br>

                    <ul class="list-group list-group-flush">
                        @foreach (var vul_string in item.Vulnerablities_Titles.Where(v => v.Label == "M").ToList())
                        {
                            <li class="list-group-item" style="background-color:navajowhite !important;">@vul_string.Text</li>
                        }
                    </ul>

                </div>
                <!--/.Panel 2-->
                <!--Panel 3-->
                <div class="tab-pane fade " id="panelL_@item.ID" role="tabpanel" >
                    <br>

                    <ul class="list-group list-group-flush" >
                        @foreach (var vul_string in item.Vulnerablities_Titles.Where(v => v.Label == "L").ToList())
                        {
                            <li class="list-group-item" style="background-color:navajowhite !important;">@vul_string.Text</li>
                        }
                    </ul>

                </div>
                <!--/.Panel 3-->


            </div>

        </div>



        <hr class="mt-1 mb-0">
        <p class="p-5 mt-3 card-text text-justify  text-center w-100 @Model.Description.GetTextLangDirection() " style="border:1px solid gray">
            @Html.Raw(item.Description_Printable)
        </p>





        @if (item.Attachments.Count > 0)
        {
            <div class="col-12">
                @{
                    var urls3 = new AttachmentUploadObject()
                    {
                        Attachments = item.Attachments,
                        ParagraphTitle = "Attachments",
                        AttachmentsIDs_FieldName = "allAttachments",
                        Do_not_insert_formId_and_Mac_inputs = true,
                        IsReadOnly = true
                    };
                    urls3.InitiateFields(ViewBag.sp);
                }
                <partial name="~/Views/Shared/Partials/Attachment/AttachmentLoader.cshtml" for="@urls3" />
            </div>
        }









        <div class="text-muted w-100 mt-4 ml-3">



            <a href="~/Responses/create?taskId=@item.ID&repliedResponse=@item.ID" class=" mr-auto mt-4 mr-3">
                <i class="fas fa-reply  text-muted  my-1 mr-3" data-toggle="tooltip" data-placement="top" title="Create a new responce that refers to this response">&nbsp Reply</i>
            </a>
            <a href="~/Responses/Delete?Id=@item.ID" class=" ml-auto mt-4 mr-3">
                <i class="fas fa-trash-alt  text-muted  my-1 mr-3" data-toggle="tooltip" data-placement="top" title="Create a new responce that refers to this response">&nbsp Delete</i>
            </a>



        </div>




    </div>

</div>
    <!-- Card -->


}



<a href="~/Responses/create?taskId=@Model.ID" class=" mt-4 mx-auto btn btn-primary btn-rounded btn-md" style="max-width:200px;">Add a New Response</a>
