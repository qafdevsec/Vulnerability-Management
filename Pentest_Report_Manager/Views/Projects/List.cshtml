@model IEnumerable<ProjectSupport.Core.Models.Project>

@{ 
    if (ViewBag.isByAjax == true)
        Layout = null;

}

    <style>
        table.table tbody tr:hover {
            -webkit-box-shadow: 2px 2px 12px -8px rgba(0,0,0,0.75);
            -moz-box-shadow: 2px 2px 12px -8px rgba(0,0,0,0.75);
            box-shadow: 2px 2px 12px -8px rgba(0,0,0,0.75);
            cursor: pointer;
        }
        table.table tbody tr td .pentest:hover {
            background: rgba(121, 85, 72, 0.3) !important;
        }
    </style>
    <span class="mt-4 d-block"></span>
    <table class="table mt-n2 border table-striped mt-2">

        <thead class=" blue-grey lighten-3">
            <tr>
                <th scope="col">Title</th>
                <td scope="col">Policy</td>
                <td scope="col">URL</td>
            </tr>
        </thead>
        <tbody>
        @{
            foreach (var proj in Model)
            {
                var task = proj.JobTasks.LastOrDefault();
                bool complated = false;
                var pentestClass ="";
                TaskResponse lastResponse=null;
                if (task != null)
                {
                    lastResponse = task.TaskResponse_to_getVulnerabilitiesCount;
                    if (lastResponse != null && (lastResponse.IsDone ||
                        (task.TaskResponses.LastOrDefault()?.High_Vulnerabilities_Count == 0 &&
                        task.TaskResponses.LastOrDefault()?.Medium_Vulnerabilities_Count == 0 &&
                        task.TaskResponses.LastOrDefault()?.Low_Vulnerabilities_Count == 0)
                        ))
                    {
                        complated = true;
                        pentestClass = "green lighten-4";
                    }
                    else if (lastResponse!=null)
                    {
                        pentestClass = "red lighten-4";
                    } else 
                    {
                        pentestClass = "rgba-yellow-light";
                        //pentestClass = "grey lighten-5";
                    }
                }

                <tr ondblclick="window.location='/Projects/@proj.ID';">
                    <td scope="row">
                        <a href="/Projects/@proj.ID" style="color:#505cff;">@(proj.ProjectName)</a>
                    </td>
                    <td class="">
                        @proj.PolicyName
                    </td>
                    <td class="d-flex">
                        @proj.URL
                    </td>
    
                    <!-- pentest -->
                    @if (!string.IsNullOrEmpty(pentestClass))
                    {
                        
                <td class="pentest d-flex p-0 mb-2 mr-2 @pentestClass" >
                    <a href='/Projects/@proj.ID/Tasks/@task.ID';" onclick="return false;" ondblclick="event.stopPropagation(); window.location='/Projects/@proj.ID/Tasks/@task.ID';" class="pentest w-100 h-100 p-2" style="text-align:initial !important;">
                        <!-- pentest state -->
                        <strong class="font-weight-bold">Pentest Status:</strong> &nbsp;
                        <strong>
                            @if (!string.IsNullOrEmpty(pentestClass))
                            {
                                @if (complated)
                                {
                                    <i class="fas fa-check fa-md pr-2" aria-hidden="true"></i>
                                }
                                else if (lastResponse == null)
                                {
                                    @("Pentesting")
                                }
                                else
                                {
                                    <span class="red-text">H:</span>@(lastResponse.High_Vulnerabilities_Count)@:,&nbsp;
                                    <span class="orange-ic">M:</span>@(lastResponse.Medium_Vulnerabilities_Count)@:,&nbsp;
                                    <span class="blue-text">L:</span>@(lastResponse.Low_Vulnerabilities_Count)
                                }
                            }
                        </strong>
                        <!-- pentest date -->
                        <strong class="ml-auto pl-3 " style="float:right;">@task.Last_Modification_DateTime_in_PersianDate</strong>
                    </a>

                </td>
                    }
                </tr>
            }
        }
    </tbody>
</table>