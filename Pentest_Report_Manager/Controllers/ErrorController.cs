using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using ProjectSupport.Core.Models;
using ProjectSupport.Infrastructure;

namespace Pentest_Report_Manager.Controllers
{
    
    public class ErrorController : Controller
    {
        private readonly ProjectSupportDB db;
        public HttpContext Context { get; }

        public ErrorController(HttpContext context, ProjectSupportDB db) {
            Context = context;
            this.db = db;
        }

        [Authorize(Roles ="Admin, Developer")]
        public IActionResult Index() {

            return View();
        }




        public IActionResult Couse(ErrorLog errorLog)
        {
            if (errorLog.SaveOnDb)
            {
                errorLog.RequestBody = Context.Items["InputRequest"].ToString();
                db.ErrorLogs.Add(errorLog);
                db.SaveChanges();
            }

            return View(errorLog);
        }



    }
}
