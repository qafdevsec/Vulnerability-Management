using System;
using System.Collections.Generic;
using System.Text;
using System.Globalization;

namespace ProjectSupport.DbUtilities
{
    class DbUtilities
    {



    }

    public static class DateTimeUtilities
    {

        /// <summary>
        /// normal datatime with shamsi numbers valuse. (the numbers style is normal)
        /// </summary>
        /// <returns></returns>
        public static DateTime? getPersianCollender_Now()
        {
            //DateTime nowUtc = DateTime.UtcNow;
            DateTime? dt = DateTime.SpecifyKind(DateTime.Now, DateTimeKind.Local);

            return dt.Convert_LocalDT_To_PersianDT();
        }

        /// <summary>
        /// returns a normal datatime with same style but only different numbers valuse as shamsi values.
        /// </summary>
        /// <returns></returns>
        public static DateTime? Convert_LocalDT_To_PersianDT(this DateTime? LocalDT)
        {
            if (LocalDT == null)
                return null;

            DateTime Local = DateTime.SpecifyKind((DateTime) LocalDT, DateTimeKind.Local);
            PersianCalendar pc = new PersianCalendar();

            DateTime dt = new DateTime(pc.GetYear(Local),
                pc.GetMonth(Local),
                pc.GetDayOfMonth(Local),
                pc.GetHour(Local),
                pc.GetMinute(Local),
                pc.GetSecond(Local),
                DateTimeKind.Local);
            return dt;

        }

        public static DateTime? Convert_PersianDT_To_LocalDT(this DateTime? persianDTv)
        {
            PersianCalendar pc = new PersianCalendar();
            DateTime _persianDTv = (DateTime)persianDTv;

            return new DateTime(_persianDTv.Year, _persianDTv.Month, _persianDTv.Day,
                _persianDTv.Hour, _persianDTv.Minute, _persianDTv.Second, pc);
        }

        public static string Convert_LocalDT_To_PersianString(this DateTime? LocalDT)
        {
            return LocalDT.Convert_LocalDT_To_PersianDT()
                .Convert_PersianDT_To_PersianString();
        }

        public static string Convert_PersianDT_To_PersianString(this DateTime? persianDt)
        {
            //DateTime now_persianDT = getPersianCollender_Now();
            //string resuly = "";
            //if (now_persianDT.Year == persianDT.Year)
            //return string.Format("{0}/{1}/{2} {3}:{4}", persianDT.Year, persianDT.Month, persianDT.Day,
            //    persianDT.Hour, persianDT.Minute);

            if (persianDt == null)
                return null;

            DateTime _persianDT = (DateTime)persianDt;

            return _persianDT.ToString("yy/MMM/ddd HH:mm", CultureInfo.GetCultureInfo("fa-IR"));
        }

        public static DateTime Convert_PersianString_To_Persian_DT(this string strDateTime, bool exactInputFormat = false, string format = @"yy/M/d hh:mm:ss tt")
        {
            DateTime result;
            if (exactInputFormat)
                result = DateTime.ParseExact(strDateTime, format, new CultureInfo("fa-IR"), DateTimeStyles.AssumeLocal);
            else
                result = DateTime.Parse(strDateTime, new CultureInfo("fa-IR"), DateTimeStyles.AssumeLocal);

            return result;
        }

    }
}
